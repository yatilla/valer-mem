<!DOCTYPE html>

<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover">
<title>Valeron Mehmet</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
:root {
  --bg: #f2f2f7; --card: #ffffff; --border: #e5e5ea;
  --text: #000000; --text2: #6c6c70; --text3: #aeaeb2;
  --accent: #007aff; --accent-bg: rgba(0,122,255,0.1);
  --green: #34c759; --red: #ff3b30; --orange: #ff9500;
  --purple: #af52de; --nav-h: 83px; --top-h: 56px;
}
html,body { height:100%; overflow:hidden; font-family:'Inter',-apple-system,sans-serif; background:var(--bg); color:var(--text); }
.shell { display:flex; flex-direction:column; height:100vh; height:100dvh; max-width:480px; margin:0 auto; background:var(--bg); overflow:hidden; }

/* â”€â”€ TOP BAR â”€â”€ */
.topbar {
height:var(â€“top-h);
background:rgba(255,255,255,0.85);
backdrop-filter:saturate(180%) blur(24px);
-webkit-backdrop-filter:saturate(180%) blur(24px);
border-bottom:0.5px solid rgba(0,0,0,0.1);
box-shadow:0 1px 0 rgba(0,0,0,0.04), 0 2px 12px rgba(0,0,0,0.05);
display:flex; align-items:center; justify-content:space-between; padding:0 18px; flex-shrink:0; z-index:50;
}
.topbar-brand .topbar-title { font-size:17px; font-weight:700; letter-spacing:-0.4px; }
.topbar-brand .topbar-sub { font-size:11px; color:var(â€“text2); font-weight:500; }
.topbar-right { display:flex; align-items:center; gap:8px; }
.pill { display:flex; align-items:center; gap:5px; padding:5px 11px; border-radius:20px; font-size:12px; font-weight:600; cursor:pointer; transition:opacity .15s; }
.pill:active { opacity:.7; }
.pill-ok { background:rgba(52,199,89,.12); color:var(â€“green); }
.pill-warn { background:rgba(255,149,0,.12); color:var(â€“orange); }
.pill-crit { background:rgba(255,59,48,.12); color:var(â€“red); animation:pp 2s infinite; }
.pill-default { background:var(â€“bg); color:var(â€“text2); border:0.5px solid var(â€“border); }
@keyframes pp { 0%,100%{box-shadow:0 0 0 0 rgba(255,59,48,0);} 50%{box-shadow:0 0 0 3px rgba(255,59,48,.15);} }

.sync-dot { width:8px; height:8px; border-radius:50%; background:var(â€“text3); flex-shrink:0; transition:background .3s; }
.sync-dot.live { background:var(â€“green); box-shadow:0 0 0 2px rgba(52,199,89,.25); }
.sync-dot.err { background:var(â€“red); }

/* â”€â”€ CONTENT â”€â”€ */
.content { flex:1; overflow:hidden; position:relative; }
.page { position:absolute; inset:0; overflow-y:auto; -webkit-overflow-scrolling:touch; opacity:0; pointer-events:none; transition:opacity .2s; padding-bottom:calc(100px + env(safe-area-inset-bottom)); scrollbar-width:none; }
.page::-webkit-scrollbar { display:none; }
.page.active { opacity:1; pointer-events:all; }

/* â”€â”€ CALENDAR â”€â”€ */
.cal-month-row { display:flex; align-items:center; justify-content:space-between; padding:14px 18px 10px; }
.cal-month-label { font-size:17px; font-weight:700; letter-spacing:-0.4px; }
.cal-nav-btns { display:flex; gap:8px; }
.nav-btn { width:30px; height:30px; border-radius:50%; background:var(â€“card); border:0.5px solid var(â€“border); box-shadow:0 1px 3px rgba(0,0,0,0.06); display:flex; align-items:center; justify-content:center; font-size:15px; cursor:pointer; color:var(â€“accent); font-weight:700; transition:background .1s; }
.nav-btn:active { background:var(â€“bg); }

.filter-scroll { display:flex; gap:7px; padding:0 18px 12px; overflow-x:auto; -webkit-overflow-scrolling:touch; scrollbar-width:none; }
.filter-scroll::-webkit-scrollbar { display:none; }
.fc { display:flex; align-items:center; gap:5px; padding:6px 12px; border-radius:20px; font-size:12px; font-weight:600; cursor:pointer; white-space:nowrap; border:0.5px solid var(â€“border); background:var(â€“card); color:var(â€“text2); flex-shrink:0; transition:all .15s; }
.fc.active { background:var(â€“accent); border-color:var(â€“accent); color:#fff; }

.dow-row { display:grid; grid-template-columns:repeat(7,1fr); padding:0 10px; margin-bottom:4px; }
.dow { text-align:center; font-size:10px; font-weight:600; color:var(â€“text3); padding:3px 0; letter-spacing:.2px; }

.cal-grid { display:grid; grid-template-columns:repeat(7,1fr); gap:4px; padding:0 10px; }

/* â”€â”€ DAY CELL (improved) â”€â”€ */
.dc {
aspect-ratio:1;
border-radius:11px;
background:var(â€“card);
display:flex; flex-direction:column; align-items:center; justify-content:flex-start;
padding:5px 2px 3px;
cursor:pointer; position:relative; overflow:hidden;
border:0.5px solid var(â€“border);
box-shadow:0 1px 2px rgba(0,0,0,0.03);
transition:transform .1s, box-shadow .1s;
}
.dc:active { transform:scale(.93); box-shadow:none; }
.dc.om { opacity:.22; pointer-events:none; }
.dc.today { border-color:var(â€“accent); border-width:1.5px; background:rgba(0,122,255,0.04); }
.dc.today .dn { color:var(â€“accent); font-weight:800; }
.dc.locked { border-color:var(â€“orange); border-width:1.5px; background:rgba(255,149,0,0.04); }
.dc.hd { box-shadow:0 1px 3px rgba(0,0,0,0.06); }

.dc-bar { position:absolute; top:0; left:0; right:0; height:2.5px; border-radius:11px 11px 0 0; }
.dn { font-size:11px; font-weight:700; line-height:1; margin-bottom:3px; color:var(â€“text); }

/* emoji grid â€” max 6, clip rest */
.da { display:grid; grid-template-columns:repeat(3,1fr); gap:1px; width:100%; justify-items:center; }
.da-i { font-size:9px; line-height:1.2; }

.ds { position:absolute; bottom:2px; right:3px; font-size:7px; font-weight:700; color:var(â€“text3); }
.ds.pos { color:var(â€“green); }
.dl { position:absolute; top:2px; right:2px; font-size:8px; }

/* suggestion dot on cell */
.dc-sug { position:absolute; bottom:2px; left:3px; width:5px; height:5px; border-radius:50%; background:var(â€“purple); }

/* â”€â”€ SECTIONS â”€â”€ */
.sec-hdr { padding:20px 18px 8px; }
.sec-hdr h2 { font-size:22px; font-weight:800; letter-spacing:-0.5px; }
.sec-hdr p { font-size:13px; color:var(â€“text2); margin-top:2px; }
.sec-label { padding:20px 18px 8px; font-size:11px; font-weight:700; color:var(â€“text3); text-transform:uppercase; letter-spacing:.8px; }

/* â”€â”€ CARDS (premium) â”€â”€ */
.card-list-wrap { margin:0 18px 12px; background:var(â€“card); border-radius:16px; overflow:hidden; border:0.5px solid rgba(0,0,0,0.08); box-shadow:0 1px 4px rgba(0,0,0,0.05), 0 4px 16px rgba(0,0,0,0.04); }
.card-item { background:var(â€“card); padding:14px 16px; display:flex; align-items:center; gap:12px; cursor:pointer; border-bottom:0.5px solid rgba(0,0,0,0.06); transition:background .1s; }
.card-item:last-child { border-bottom:none; }
.card-item:active { background:rgba(0,0,0,0.03); }
.ci-left { display:flex; align-items:center; gap:12px; flex:1; min-width:0; }
.ci-icon { font-size:26px; flex-shrink:0; }
.ci-info { flex:1; min-width:0; }
.ci-title { font-size:15px; font-weight:700; letter-spacing:-0.2px; }
.ci-sub { font-size:12px; color:var(â€“text2); margin-top:1px; }
.ci-right { display:flex; flex-direction:column; align-items:flex-end; gap:4px; flex-shrink:0; }

.badge { display:inline-flex; align-items:center; padding:3px 9px; border-radius:20px; font-size:11px; font-weight:700; }
.badge-blue { background:var(â€“accent-bg); color:var(â€“accent); }
.badge-green { background:rgba(52,199,89,.12); color:var(â€“green); }
.badge-orange { background:rgba(255,149,0,.12); color:var(â€“orange); }
.badge-red { background:rgba(255,59,48,.1); color:var(â€“red); }
.badge-gray { background:rgba(0,0,0,0.06); color:var(â€“text2); }

/* â”€â”€ BEST â”€â”€ */
.best-card { margin:0 18px 10px; background:var(â€“card); border-radius:16px; overflow:hidden; border:0.5px solid rgba(0,0,0,0.08); box-shadow:0 2px 8px rgba(0,0,0,0.06), 0 6px 24px rgba(0,0,0,0.04); }
.best-card-top { height:3px; }
.bc-body { padding:16px 16px 12px; }
.bc-rank { font-size:10px; font-weight:700; color:var(â€“text3); letter-spacing:1px; text-transform:uppercase; margin-bottom:4px; }
.bc-date { font-size:17px; font-weight:800; letter-spacing:-0.4px; margin-bottom:10px; }
.bc-pills { display:flex; flex-wrap:wrap; gap:5px; margin-bottom:10px; }
.bc-pill { display:flex; align-items:center; gap:3px; padding:4px 9px; border-radius:20px; font-size:11px; font-weight:600; }
.bcp-y { background:rgba(52,199,89,.1); color:var(â€“green); }
.bcp-m { background:rgba(0,122,255,.1); color:var(â€“accent); }
.bcp-h { background:rgba(255,149,0,.1); color:var(â€“orange); }
.bcp-n { background:rgba(255,59,48,.07); color:var(â€“red); opacity:.7; }
.bc-footer { padding:10px 16px; border-top:0.5px solid rgba(0,0,0,0.06); display:flex; gap:8px; background:rgba(0,0,0,0.01); }

/* â”€â”€ KPI â”€â”€ */
.kpi-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; padding:0 18px 12px; }
.kpi { background:var(â€“card); border-radius:16px; padding:16px; border:0.5px solid rgba(0,0,0,0.08); box-shadow:0 1px 4px rgba(0,0,0,0.05), 0 4px 16px rgba(0,0,0,0.03); }
.kpi-label { font-size:11px; font-weight:600; color:var(â€“text2); margin-bottom:6px; }
.kpi-val { font-size:28px; font-weight:800; letter-spacing:-1px; line-height:1; }
.kpi-sub { font-size:11px; color:var(â€“text3); margin-top:3px; }
.kv-blue{color:var(â€“accent);} .kv-green{color:var(â€“green);} .kv-red{color:var(â€“red);}
.chaos-wrap { margin:0 18px 12px; }
.chaos-card { background:var(â€“card); border-radius:16px; padding:16px; border:0.5px solid rgba(0,0,0,0.08); box-shadow:0 1px 4px rgba(0,0,0,0.05); }
.chaos-header { display:flex; align-items:flex-end; justify-content:space-between; margin-bottom:10px; }
.chaos-val { font-size:36px; font-weight:800; letter-spacing:-1.5px; line-height:1; }
.chaos-bar { height:6px; background:var(â€“bg); border-radius:3px; overflow:hidden; }
.chaos-fill { height:100%; background:linear-gradient(90deg,var(â€“green),var(â€“orange),var(â€“red)); border-radius:3px; transition:width .6s; }

/* â”€â”€ LOCKED â”€â”€ */
.locked-card { margin:0 18px 10px; background:var(â€“card); border-radius:16px; overflow:hidden; border:0.5px solid rgba(255,149,0,.3); box-shadow:0 2px 8px rgba(255,149,0,.08); }
.locked-banner { background:rgba(255,149,0,.06); padding:14px 16px; display:flex; align-items:center; justify-content:space-between; border-bottom:0.5px solid rgba(255,149,0,.12); }
.locked-date-str { font-size:15px; font-weight:800; letter-spacing:-0.3px; }
.locked-time { font-size:12px; font-weight:700; color:var(â€“orange); background:rgba(255,149,0,.12); padding:4px 10px; border-radius:20px; }
.locked-body { padding:14px 16px; }
.locked-sec { font-size:10px; font-weight:700; color:var(â€“text3); letter-spacing:1px; text-transform:uppercase; margin-bottom:7px; }
.locked-pills { display:flex; flex-wrap:wrap; gap:5px; margin-bottom:12px; }
.wa-box { background:var(â€“bg); border-radius:10px; padding:10px 12px; font-size:11px; color:var(â€“text2); white-space:pre-wrap; line-height:1.6; font-family:monospace; margin-bottom:10px; }
.locked-quote { text-align:center; font-size:13px; color:var(â€“text3); font-style:italic; padding:4px 0 8px; }
.locked-footer { padding:10px 16px; border-top:0.5px solid rgba(0,0,0,0.06); display:flex; gap:7px; flex-wrap:wrap; background:rgba(0,0,0,0.01); }

/* â”€â”€ LEAGUE â”€â”€ */
.league-item { display:flex; align-items:center; gap:12px; padding:13px 16px; border-bottom:0.5px solid rgba(0,0,0,0.06); }
.league-item:last-child { border-bottom:none; }
.li-rank { font-size:15px; font-weight:800; width:28px; text-align:center; flex-shrink:0; color:var(â€“text3); }
.li-rank.g{color:#FFD700;} .li-rank.s{color:#C0C0C0;} .li-rank.b{color:#CD7F32;}
.li-emoji { font-size:30px; flex-shrink:0; }
.li-info { flex:1; min-width:0; }
.li-name { font-size:15px; font-weight:700; }
.li-badges { font-size:13px; margin-top:2px; }
.li-right { display:flex; flex-direction:column; align-items:flex-end; gap:5px; }
.li-score { font-size:17px; font-weight:800; }
.li-bar { width:60px; height:3px; background:var(â€“bg); border-radius:3px; overflow:hidden; }
.li-bar-fill { height:100%; border-radius:3px; background:linear-gradient(90deg,var(â€“accent),var(â€“purple)); }

/* â”€â”€ BOTTOM NAV (depth) â”€â”€ */
.bottom-nav {
height:calc(var(â€“nav-h) + env(safe-area-inset-bottom));
background:rgba(255,255,255,0.85);
backdrop-filter:saturate(180%) blur(24px);
-webkit-backdrop-filter:saturate(180%) blur(24px);
border-top:0.5px solid rgba(0,0,0,0.1);
box-shadow:0 -1px 0 rgba(0,0,0,0.04), 0 -4px 16px rgba(0,0,0,0.06);
display:flex; align-items:flex-start; padding-top:8px; padding-bottom:env(safe-area-inset-bottom); flex-shrink:0; z-index:50;
}
.bn-item { flex:1; display:flex; flex-direction:column; align-items:center; gap:3px; cursor:pointer; padding:4px 0; position:relative; transition:opacity .1s; }
.bn-item:active { opacity:.6; }
.bn-icon { font-size:24px; line-height:1; transition:transform .2s cubic-bezier(.34,1.56,.64,1); }
.bn-item.active .bn-icon { transform:scale(1.12); }
.bn-label { font-size:10px; font-weight:600; color:var(â€“text3); transition:color .15s; }
.bn-item.active .bn-label { color:var(â€“accent); }
.bn-dot { position:absolute; top:2px; right:calc(50% - 16px); width:8px; height:8px; background:var(â€“red); border-radius:50%; border:1.5px solid #fff; display:none; }
.bn-dot.show { display:block; }

/* â”€â”€ MODAL (improved) â”€â”€ */
.modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.45); z-index:200; display:flex; align-items:flex-end; opacity:0; pointer-events:none; transition:opacity .25s; }
.modal-overlay.open { opacity:1; pointer-events:all; }
.modal-sheet {
width:100%; max-width:480px; margin:0 auto;
background:var(â€“card);
border-radius:22px 22px 0 0;
padding:0 0 calc(24px + env(safe-area-inset-bottom));
transform:translateY(100%);
transition:transform .32s cubic-bezier(.32,.72,0,1);
max-height:92vh; overflow-y:auto;
box-shadow:0 -8px 40px rgba(0,0,0,0.16), 0 -2px 8px rgba(0,0,0,0.08);
}
.modal-overlay.open .modal-sheet { transform:translateY(0); }
.modal-handle { width:36px; height:4px; background:var(â€“text3); border-radius:2px; margin:12px auto 0; opacity:.3; }
.modal-hdr { padding:16px 20px 14px; border-bottom:0.5px solid rgba(0,0,0,0.08); }
.modal-title { font-size:18px; font-weight:800; letter-spacing:-0.4px; }
.modal-sub { font-size:13px; color:var(â€“text2); margin-top:2px; font-weight:500; }

.person-select-row { padding:14px 20px 4px; }
.ps-label { font-size:11px; font-weight:700; color:var(â€“text3); text-transform:uppercase; letter-spacing:.6px; margin-bottom:8px; display:block; }
.ps-scroll { display:flex; gap:7px; overflow-x:auto; padding-bottom:4px; scrollbar-width:none; }
.ps-scroll::-webkit-scrollbar { display:none; }
.ps-chip { display:flex; align-items:center; gap:5px; padding:7px 13px; border-radius:20px; font-size:12px; font-weight:600; cursor:pointer; white-space:nowrap; border:1.5px solid var(â€“border); background:var(â€“bg); color:var(â€“text2); flex-shrink:0; transition:all .15s; }
.ps-chip.active { border-color:var(â€“accent); background:var(â€“accent); color:#fff; }

.status-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; padding:14px 20px; }
.st-tile { background:var(â€“bg); border:1.5px solid var(â€“border); border-radius:14px; padding:14px 10px; text-align:center; cursor:pointer; transition:all .15s; }
.st-tile:active { transform:scale(.94); }
.st-icon { font-size:26px; margin-bottom:5px; }
.st-label { font-size:12px; font-weight:700; color:var(â€“text); }
.st-pts { font-size:10px; color:var(â€“text3); margin-top:2px; }
.st-tile.sel-y{border-color:var(â€“green);background:rgba(52,199,89,.08);}
.st-tile.sel-m{border-color:var(â€“accent);background:var(â€“accent-bg);}
.st-tile.sel-h{border-color:var(â€“orange);background:rgba(255,149,0,.08);}
.st-tile.sel-n{border-color:var(â€“red);background:rgba(255,59,48,.06);}

.modal-actions { padding:0 20px 14px; display:flex; gap:10px; }

/* â”€â”€ SUGGESTIONS SECTION â”€â”€ */
.sug-section { padding:0 20px 8px; }
.sug-divider { height:0.5px; background:rgba(0,0,0,0.08); margin:4px 0 16px; }
.sug-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; }
.sug-title { font-size:13px; font-weight:700; color:var(â€“text); }
.sug-anon-badge { font-size:10px; font-weight:600; color:var(â€“purple); background:rgba(175,82,222,.1); padding:3px 8px; border-radius:20px; }

.sug-input-row { display:flex; gap:8px; margin-bottom:14px; }
.sug-input {
flex:1; padding:10px 14px; border-radius:12px;
border:1.5px solid var(â€“border); background:var(â€“bg);
font-family:â€˜Interâ€™,sans-serif; font-size:13px; font-weight:500;
color:var(â€“text); outline:none; transition:border-color .15s;
-webkit-appearance:none;
}
.sug-input:focus { border-color:var(â€“purple); }
.sug-input::placeholder { color:var(â€“text3); }
.sug-send-btn {
width:40px; height:40px; border-radius:12px;
background:var(â€“purple); border:none; cursor:pointer;
display:flex; align-items:center; justify-content:center;
font-size:16px; flex-shrink:0; transition:opacity .15s;
box-shadow:0 2px 8px rgba(175,82,222,.3);
}
.sug-send-btn:active { opacity:.7; }

.sug-list { display:flex; flex-direction:column; gap:8px; }

.sug-item {
background:var(â€“bg); border-radius:12px; padding:11px 12px;
border:0.5px solid rgba(0,0,0,0.06);
display:flex; align-items:center; gap:10px;
}
.sug-text { flex:1; font-size:13px; font-weight:500; color:var(â€“text); line-height:1.4; min-width:0; }
.sug-votes { display:flex; gap:5px; flex-shrink:0; }
.vote-btn {
display:flex; align-items:center; gap:3px;
padding:5px 9px; border-radius:20px;
font-size:11px; font-weight:700; cursor:pointer;
border:none; font-family:â€˜Interâ€™,sans-serif;
transition:all .15s; background:var(â€“card);
border:1px solid var(â€“border);
}
.vote-btn:active { transform:scale(.9); }
.vote-btn.voted-up { background:rgba(52,199,89,.12); color:var(â€“green); border-color:rgba(52,199,89,.25); }
.vote-btn.voted-down { background:rgba(255,59,48,.1); color:var(â€“red); border-color:rgba(255,59,48,.2); }
.vote-count { font-size:11px; font-weight:700; color:var(â€“text2); }

.sug-empty { text-align:center; padding:16px 0 4px; font-size:13px; color:var(â€“text3); }

/* â”€â”€ BUTTONS â”€â”€ */
.btn { display:inline-flex; align-items:center; justify-content:center; gap:5px; padding:11px 16px; border-radius:13px; font-size:14px; font-weight:600; cursor:pointer; border:none; font-family:â€˜Interâ€™,sans-serif; transition:opacity .15s; }
.btn:active { opacity:.7; }
.btn-primary { background:var(â€“accent); color:#fff; flex:1; box-shadow:0 2px 8px rgba(0,122,255,.25); }
.btn-secondary { background:rgba(0,0,0,0.06); color:var(â€“text2); }
.btn-sm { padding:7px 13px; font-size:12px; border-radius:10px; background:rgba(0,0,0,0.06); color:var(â€“text2); border:none; cursor:pointer; font-family:â€˜Interâ€™,sans-serif; font-weight:600; transition:opacity .15s; }
.btn-sm:active { opacity:.7; }
.btn-sm-primary { background:var(â€“accent); color:#fff; box-shadow:0 1px 4px rgba(0,122,255,.2); }
.btn-sm-orange { background:rgba(255,149,0,.12); color:var(â€“orange); }
.btn-sm-green { background:rgba(52,199,89,.12); color:var(â€“green); }

/* â”€â”€ EMPTY STATE (premium) â”€â”€ */
.empty { text-align:center; padding:52px 24px; color:var(â€“text3); }
.empty-icon { font-size:56px; margin-bottom:14px; filter:drop-shadow(0 4px 12px rgba(0,0,0,0.08)); }
.empty h3 { font-size:17px; font-weight:700; color:var(â€“text2); margin-bottom:6px; letter-spacing:-0.2px; }
.empty p { font-size:14px; line-height:1.5; color:var(â€“text3); }

/* â”€â”€ TOAST â”€â”€ */
.toast-wrap { position:fixed; top:70px; left:50%; transform:translateX(-50%); z-index:300; display:flex; flex-direction:column; gap:6px; align-items:center; pointer-events:none; }
.toast { background:rgba(20,20,20,0.88); color:#fff; padding:10px 18px; border-radius:22px; font-size:13px; font-weight:600; white-space:nowrap; animation:tin .22s ease; box-shadow:0 4px 16px rgba(0,0,0,0.2); backdrop-filter:blur(12px); }
@keyframes tin { from{opacity:0;transform:translateY(-10px) scale(.93);}to{opacity:1;transform:none;} }

/* â”€â”€ LOADING â”€â”€ */
.loading-screen { position:fixed; inset:0; background:var(â€“bg); display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:500; gap:16px; transition:opacity .4s; }
.loading-screen.hidden { opacity:0; pointer-events:none; }
.loading-spinner { width:40px; height:40px; border:3px solid var(â€“border); border-top-color:var(â€“accent); border-radius:50%; animation:spin .8s linear infinite; }
@keyframes spin { to{transform:rotate(360deg);} }
.loading-text { font-size:15px; font-weight:600; color:var(â€“text2); }
</style>

</head>
<body>

<div class="loading-screen" id="loadingScreen">
  <div style="font-size:44px;filter:drop-shadow(0 4px 16px rgba(0,0,0,0.12))">âš”</div>
  <div class="loading-spinner"></div>
  <div class="loading-text">BaÄŸlanÄ±yor...</div>
</div>

<div class="shell">

  <div class="topbar">
    <div class="topbar-brand">
      <div class="topbar-title">âš” Valeron Mehmet</div>
      <div class="topbar-sub">ArkadaÅŸlÄ±k Ligi</div>
    </div>
    <div class="topbar-right">
      <div class="sync-dot" id="syncDot"></div>
      <div id="meterPill" class="pill pill-default" onclick="setLastMeeting()">
        <span id="mIco">ğŸ“…</span><span id="mTxt">â€”</span>
      </div>
    </div>
  </div>

  <div class="content">

```
<!-- CALENDAR -->
<div class="page active" id="pCalendar">
  <div class="cal-month-row">
    <div class="cal-month-label" id="calMo">â€”</div>
    <div class="cal-nav-btns">
      <div class="nav-btn" onclick="chMo(-1)">â€¹</div>
      <div class="nav-btn" onclick="chMo(1)">â€º</div>
    </div>
  </div>
  <div class="filter-scroll" id="filterRow"></div>
  <div class="dow-row">
    <div class="dow">Pzt</div><div class="dow">Sal</div><div class="dow">Ã‡ar</div>
    <div class="dow">Per</div><div class="dow">Cum</div><div class="dow">Cmt</div><div class="dow">Paz</div>
  </div>
  <div class="cal-grid" id="cGrid"></div>
  <div class="sec-label">Bu Ayki Durum</div>
  <div class="card-list-wrap" id="quickInfo"></div>
</div>

<!-- BEST -->
<div class="page" id="pBest">
  <div class="sec-hdr"><h2>En Ä°yi Tarihler</h2><p>AÄŸÄ±rlÄ±klÄ± puana gÃ¶re Ã¶neriler</p></div>
  <div id="bestList"></div>
</div>

<!-- LEAGUE -->
<div class="page" id="pLeague">
  <div class="sec-hdr"><h2>Lig Tablosu</h2><p>Kim ne kadar sosyal?</p></div>
  <div class="card-list-wrap" id="leagueList"></div>
  <div class="sec-label">Rozetler</div>
  <div class="card-list-wrap" id="badgeList"></div>
</div>

<!-- STATS -->
<div class="page" id="pStats">
  <div class="sec-hdr"><h2>Ä°statistikler</h2><p>SayÄ±lar yalan sÃ¶ylemez</p></div>
  <div class="kpi-grid" id="kpiGrid"></div>
  <div class="chaos-wrap"><div class="chaos-card" id="chaosCard"></div></div>
  <div class="sec-label">KiÅŸi DÃ¶kÃ¼mÃ¼</div>
  <div class="card-list-wrap" id="personBreakdown"></div>
</div>

<!-- LOCKED + SETTINGS -->
<div class="page" id="pLocked">
  <div class="sec-hdr"><h2>Kilitlenen</h2><p>Takvim konuÅŸtu. KaÃ§Ä±ÅŸ yok.</p></div>
  <div id="lockedList"></div>
  <div class="sec-label">Ayarlar</div>
  <div class="card-list-wrap">
    <div class="card-item" onclick="setLastMeeting()">
      <div class="ci-left"><div class="ci-icon">ğŸ“…</div><div class="ci-info"><div class="ci-title">Son BuluÅŸmayÄ± GÃ¼ncelle</div><div class="ci-sub" id="lastMeetingLabel">Tarih girilmedi</div></div></div>
    </div>
    <div class="card-item" onclick="resetData()">
      <div class="ci-left"><div class="ci-icon">ğŸ—‘</div><div class="ci-info"><div class="ci-title" style="color:var(--red)">TÃ¼m Verileri SÄ±fÄ±rla</div><div class="ci-sub">Herkesten silinir</div></div></div>
    </div>
  </div>
</div>
```

  </div>

  <div class="bottom-nav">
    <div class="bn-item active" onclick="showPage('Calendar',this)">
      <div class="bn-icon">ğŸ—“</div><div class="bn-label">Takvim</div>
    </div>
    <div class="bn-item" onclick="showPage('Best',this)">
      <div class="bn-icon">â­</div><div class="bn-label">En Ä°yi</div>
    </div>
    <div class="bn-item" onclick="showPage('League',this)">
      <div class="bn-icon">ğŸ†</div><div class="bn-label">Lig</div>
    </div>
    <div class="bn-item" onclick="showPage('Stats',this)">
      <div class="bn-icon">ğŸ“Š</div><div class="bn-label">Ä°statistik</div>
    </div>
    <div class="bn-item" onclick="showPage('Locked',this)">
      <div class="bn-icon">ğŸ”’</div><div class="bn-label">Kilitli</div>
      <div class="bn-dot" id="lockDot"></div>
    </div>
  </div>
</div>

<!-- MODAL -->

<div class="modal-overlay" id="modalOverlay" onclick="maybeClose(event)">
  <div class="modal-sheet">
    <div class="modal-handle"></div>
    <div class="modal-hdr">
      <div class="modal-title" id="modalTitle">MÃ¼saitlik Gir</div>
      <div class="modal-sub" id="modalSub"></div>
    </div>
    <div class="person-select-row">
      <span class="ps-label">KiÅŸi seÃ§</span>
      <div class="ps-scroll" id="personChips"></div>
    </div>
    <div class="status-grid">
      <div class="st-tile" id="st-yes" onclick="setSt('yes')"><div class="st-icon">âœ…</div><div class="st-label">Kesin</div><div class="st-pts">+3 puan</div></div>
      <div class="st-tile" id="st-maybe" onclick="setSt('maybe')"><div class="st-icon">ğŸ¤”</div><div class="st-label">BÃ¼yÃ¼k Ä°htimalle</div><div class="st-pts">+2 puan</div></div>
      <div class="st-tile" id="st-hard" onclick="setSt('hard')"><div class="st-icon">ğŸŸ¡</div><div class="st-label">ZorlarÄ±m</div><div class="st-pts">+1 puan</div></div>
      <div class="st-tile" id="st-no" onclick="setSt('no')"><div class="st-icon">âŒ</div><div class="st-label">MÃ¼sait DeÄŸilim</div><div class="st-pts">âˆ’2 puan</div></div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="clearSt()">Temizle</button>
      <button class="btn btn-primary" onclick="closeModal()">Tamam</button>
    </div>

```
<!-- â”€â”€ SUGGESTIONS â”€â”€ -->
<div class="sug-section">
  <div class="sug-divider"></div>
  <div class="sug-header">
    <div class="sug-title">ğŸ’¡ Anonim Ã–neriler</div>
    <div class="sug-anon-badge">anonim</div>
  </div>
  <div class="sug-input-row">
    <input class="sug-input" id="sugInput" type="text" placeholder="Mekan, aktivite, iÃ§ecek Ã¶nerâ€¦" maxlength="120" onkeydown="if(event.key==='Enter')addSuggestion(selKey,this.value)">
    <button class="sug-send-btn" onclick="addSuggestion(selKey,document.getElementById('sugInput').value)">â¤</button>
  </div>
  <div class="sug-list" id="sugList"></div>
</div>
```

  </div>
</div>

<div class="toast-wrap" id="tw"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBrpwLW_Kn_crX5rqueYymaACT2_ANLRmA",
  authDomain: "duvar-8a77d.firebaseapp.com",
  databaseURL: "https://duvar-8a77d-default-rtdb.firebaseio.com",
  projectId: "duvar-8a77d",
  storageBucket: "duvar-8a77d.firebasestorage.app",
  messagingSenderId: "499059696985",
  appId: "1:499059696985:web:431799e27550b836efd848"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const dbRef = ref(db, 'valeron-mehmet');

// â”€â”€â”€ CONFIG â”€â”€â”€
const P = [
  {id:'volkan',  name:'Volkan',      e:'ğŸ¦Š'},
  {id:'melisa',  name:'Melisa',      e:'ğŸŒ™'},
  {id:'sude',    name:'Sude',        e:'ğŸ'},
  {id:'yagmury', name:'Y. YÄ±lmaz',  e:'ğŸ¯'},
  {id:'yagmura', name:'Y. Atilla',  e:'ğŸ¦'},
  {id:'gorkem',  name:'Gorkem',      e:'ğŸ¥'},
  {id:'emre',    name:'Emre',        e:'ğŸ»â€â„ï¸'},
  {id:'alper',   name:'Alper',       e:'ğŸ»'},
];
const SS = {yes:3, maybe:2, hard:1, no:-2};
const SL = {yes:'Kesin', maybe:'BÃ¼yÃ¼k Ä°htimalle', hard:'ZorlarÄ±m', no:'MÃ¼sait DeÄŸil'};
const SC = {yes:'var(--green)', maybe:'var(--accent)', hard:'var(--orange)', no:'var(--red)'};
const MO = ['Ocak','Åubat','Mart','Nisan','MayÄ±s','Haziran','Temmuz','AÄŸustos','EylÃ¼l','Ekim','KasÄ±m','AralÄ±k'];
const DY = ['Pazar','Pazartesi','SalÄ±','Ã‡arÅŸamba','PerÅŸembe','Cuma','Cumartesi'];

let D = {availability:{}, lockedDates:[], lastMeeting:null, suggestions:{}};
let vDate = new Date(), aF = 'all', selKey = null, selPid = P[0].id;

function dk(y,m,d){return `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;}
function pdk(k){const[y,m,d]=k.split('-').map(Number);return new Date(y,m-1,d);}

// â”€â”€â”€ FIREBASE â”€â”€â”€
function saveToFirebase() {
  set(dbRef, D).catch(e => { console.error(e); toast('âš  KayÄ±t hatasÄ±'); });
}

onValue(dbRef, (snapshot) => {
  const data = snapshot.val();
  if (data) {
    D = { availability:{}, lockedDates:[], lastMeeting:null, suggestions:{}, ...data };
    if (!Array.isArray(D.lockedDates)) D.lockedDates = Object.values(D.lockedDates || {});
    if (!D.suggestions) D.suggestions = {};
  }
  const ls = document.getElementById('loadingScreen');
  ls.classList.add('hidden');
  setTimeout(() => ls.style.display='none', 400);
  document.getElementById('syncDot').className = 'sync-dot live';
  renderAll();
  // re-render suggestions if modal is open
  if (document.getElementById('modalOverlay').classList.contains('open') && selKey) {
    renderSuggestions(selKey);
  }
}, (error) => {
  console.error(error);
  document.getElementById('syncDot').className = 'sync-dot err';
  document.getElementById('loadingScreen').classList.add('hidden');
  toast('âš  BaÄŸlantÄ± hatasÄ±');
});

buildFilterRow();
buildPersonChips();

function renderAll() {
  renderCal();
  renderMeter();
  const active = document.querySelector('.page.active')?.id;
  if(active==='pBest') renderBest();
  if(active==='pLeague') renderLeague();
  if(active==='pStats') renderStats();
  if(active==='pLocked') renderLocked();
  updLockDot();
  updLastMeetingLabel();
}

// â”€â”€â”€ NAV â”€â”€â”€
window.showPage = function(name, el) {
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById('p'+name).classList.add('active');
  document.querySelectorAll('.bn-item').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  if(name==='Best') renderBest();
  if(name==='League') renderLeague();
  if(name==='Stats') renderStats();
  if(name==='Locked') renderLocked();
};

// â”€â”€â”€ FILTER â”€â”€â”€
function buildFilterRow() {
  document.getElementById('filterRow').innerHTML =
    `<div class="fc active" onclick="setF('all',this)">ğŸ‘¥ Herkes</div>` +
    P.map(p=>`<div class="fc" onclick="setF('${p.id}',this)">${p.e} ${p.name}</div>`).join('');
}
window.setF = function(v, el) {
  aF=v;
  document.querySelectorAll('.fc').forEach(c=>c.classList.remove('active'));
  el.classList.add('active');
  renderCal();
};

// â”€â”€â”€ PERSON CHIPS â”€â”€â”€
function buildPersonChips() {
  document.getElementById('personChips').innerHTML = P.map((p,i)=>
    `<div class="ps-chip ${i===0?'active':''}" onclick="selectPerson('${p.id}',this)">${p.e} ${p.name}</div>`
  ).join('');
}
window.selectPerson = function(pid, el) {
  selPid=pid;
  document.querySelectorAll('.ps-chip').forEach(c=>c.classList.remove('active'));
  el.classList.add('active');
  refreshModal();
};

// â”€â”€â”€ CALENDAR â”€â”€â”€
window.chMo = function(d) { vDate=new Date(vDate.getFullYear(),vDate.getMonth()+d,1); renderCal(); };

function renderCal() {
  const y=vDate.getFullYear(), m=vDate.getMonth();
  document.getElementById('calMo').textContent = `${MO[m]} ${y}`;
  const grid=document.getElementById('cGrid'); grid.innerHTML='';
  const fd=(new Date(y,m,1).getDay()+6)%7, ld=new Date(y,m+1,0).getDate();
  const today=new Date(), pl=new Date(y,m,0).getDate();
  for(let i=fd-1;i>=0;i--) grid.appendChild(mkCell(y,m-1,pl-i,true));
  for(let d=1;d<=ld;d++) {
    const c=mkCell(y,m,d,false);
    if(today.getFullYear()===y&&today.getMonth()===m&&today.getDate()===d) c.classList.add('today');
    grid.appendChild(c);
  }
  const rem=(7-(fd+ld)%7)%7;
  for(let d=1;d<=rem;d++) grid.appendChild(mkCell(y,m+1,d,true));
  renderQuickInfo(y,m);
}

function mkCell(y,m,d,om) {
  const key=dk(y,m,d), dd=D.availability[key]||{}, isL=D.lockedDates.some(l=>l.date===key);
  let sc=0; Object.values(dd).forEach(s=>sc+=SS[s]||0);
  const hasSug = D.suggestions && D.suggestions[key] && Object.keys(D.suggestions[key]).length > 0;

  const c=document.createElement('div');
  c.className='dc'+(om?' om':'')+(isL?' locked':'')+(Object.keys(dd).length?' hd':'');

  if(sc>0&&!om){
    const bar=document.createElement('div'); bar.className='dc-bar';
    const pct=Math.min(sc/(P.length*3),1);
    bar.style.background=`linear-gradient(90deg,var(--green) ${pct*100}%,var(--border) ${pct*100}%)`;
    c.appendChild(bar);
  }

  const dn=document.createElement('div'); dn.className='dn'; dn.textContent=d; c.appendChild(dn);
  const da=document.createElement('div'); da.className='da';

  if(aF==='all') {
    const entries = P.filter(p=>dd[p.id]).slice(0,6);
    entries.forEach(p=>{
      const a=document.createElement('div'); a.className='da-i';
      a.textContent=p.e; a.style.opacity=dd[p.id]==='no'?'0.3':'1'; da.appendChild(a);
    });
  } else if(dd[aF]) {
    const dot=document.createElement('div');
    dot.style.cssText=`width:6px;height:6px;border-radius:50%;margin-top:2px;background:${SC[dd[aF]]||'#ccc'};`;
    da.appendChild(dot);
  }
  c.appendChild(da);

  if(sc!==0&&!om&&aF==='all'){
    const s=document.createElement('div'); s.className='ds'+(sc>0?' pos':''); s.textContent=(sc>0?'+':'')+sc; c.appendChild(s);
  }
  if(isL){const li=document.createElement('div');li.className='dl';li.textContent='ğŸ”’';c.appendChild(li);}
  if(hasSug&&!om){const sd=document.createElement('div');sd.className='dc-sug';c.appendChild(sd);}

  c.onclick=()=>openModal(y,m,d,key);
  return c;
}

function renderQuickInfo(y,m) {
  const scored = Object.entries(D.availability)
    .filter(([k])=>{const dt=pdk(k);return dt.getFullYear()===y&&dt.getMonth()===m;})
    .map(([k,dd])=>{let s=0;Object.values(dd).forEach(st=>s+=SS[st]||0);return{k,s,dd};})
    .filter(x=>x.s>0).sort((a,b)=>b.s-a.s);
  const allSt=Object.values(D.availability).flatMap(d=>Object.values(d));
  const yc=allSt.filter(s=>s==='yes').length, nc=allSt.filter(s=>s==='no').length;
  const chaos=allSt.length?Math.round((nc/allSt.length)*100):0;
  let html='';
  if(scored.length){
    const b=scored[0], dt=pdk(b.k);
    const ycc=Object.values(b.dd).filter(s=>s==='yes').length;
    html+=`<div class="card-item"><div class="ci-left"><div class="ci-icon">â­</div><div class="ci-info"><div class="ci-title">En Ä°yi GÃ¼n</div><div class="ci-sub">${dt.getDate()} ${MO[dt.getMonth()]} â€” ${ycc} kesin</div></div></div><div class="ci-right"><div class="badge badge-blue">+${b.s}p</div></div></div>`;
  }
  html+=`<div class="card-item"><div class="ci-left"><div class="ci-icon">ğŸ“Š</div><div class="ci-info"><div class="ci-title">Kaos Seviyesi</div><div class="ci-sub">${chaos>50?'ğŸ”¥ Kritik!':chaos>25?'âš¡ Dikkat':'âœ… Sakin'}</div></div></div><div class="ci-right"><div class="badge ${chaos>50?'badge-red':chaos>25?'badge-orange':'badge-green'}">${chaos}%</div></div></div>`;
  html+=`<div class="card-item"><div class="ci-left"><div class="ci-icon">ğŸ‘¥</div><div class="ci-info"><div class="ci-title">Toplam Ä°ÅŸaret</div><div class="ci-sub">${yc} kesin, ${nc} bahane</div></div></div><div class="ci-right"><div class="badge badge-gray">${allSt.length}</div></div></div>`;
  document.getElementById('quickInfo').innerHTML=html;
}

// â”€â”€â”€ MODAL â”€â”€â”€
window.openModal = function(y,m,d,key) {
  selKey=key;
  document.getElementById('modalTitle').textContent=`${d} ${MO[m]} ${y}`;
  document.getElementById('modalSub').textContent=DY[pdk(key).getDay()];
  selPid=P[0].id;
  document.querySelectorAll('.ps-chip').forEach((c,i)=>c.classList.toggle('active',i===0));
  refreshModal();
  renderSuggestions(key);
  document.getElementById('sugInput').value='';
  document.getElementById('modalOverlay').classList.add('open');
};
window.maybeClose = function(e){if(e.target===document.getElementById('modalOverlay'))closeModal();};
window.closeModal = function(){document.getElementById('modalOverlay').classList.remove('open');};

function refreshModal() {
  const cur=(D.availability[selKey]||{})[selPid];
  const map={yes:'sel-y',maybe:'sel-m',hard:'sel-h',no:'sel-n'};
  ['yes','maybe','hard','no'].forEach(s=>{
    const t=document.getElementById('st-'+s);
    t.className='st-tile'+(s===cur?' '+map[s]:'');
  });
}

window.setSt = function(s) {
  if(!D.availability[selKey]) D.availability[selKey]={};
  D.availability[selKey][selPid]=s;
  saveToFirebase();
  refreshModal();
  toast(`${P.find(p=>p.id===selPid).e} ${SL[s]}`);
};

window.clearSt = function() {
  if(D.availability[selKey]){
    delete D.availability[selKey][selPid];
    if(!Object.keys(D.availability[selKey]).length) delete D.availability[selKey];
  }
  saveToFirebase(); refreshModal(); closeModal();
};

// â”€â”€â”€ SUGGESTIONS â”€â”€â”€
window.addSuggestion = function(dateKey, text) {
  text = (text||'').trim();
  if(!text || !dateKey) return;
  if(!D.suggestions) D.suggestions={};
  if(!D.suggestions[dateKey]) D.suggestions[dateKey]={};
  const id = 'sug_' + Date.now() + '_' + Math.random().toString(36).slice(2,6);
  D.suggestions[dateKey][id] = { text, createdAt: Date.now(), up:0, down:0 };
  saveToFirebase();
  document.getElementById('sugInput').value='';
  renderSuggestions(dateKey);
  toast('ğŸ’¡ Ã–neri eklendi');
};

window.voteSuggestion = function(dateKey, suggestionId, dir) {
  const voteKey = `voted_${dateKey}_${suggestionId}`;
  const prev = localStorage.getItem(voteKey);
  if(prev === dir) return; // already voted same dir

  if(!D.suggestions) D.suggestions={};
  if(!D.suggestions[dateKey]) D.suggestions[dateKey]={};
  const sug = D.suggestions[dateKey][suggestionId];
  if(!sug) return;

  // undo previous vote if switching
  if(prev && prev !== dir) {
    if(prev==='up') sug.up = Math.max(0,(sug.up||0)-1);
    if(prev==='down') sug.down = Math.max(0,(sug.down||0)-1);
  }

  if(dir==='up') sug.up = (sug.up||0)+1;
  if(dir==='down') sug.down = (sug.down||0)+1;

  localStorage.setItem(voteKey, dir);
  saveToFirebase();
  renderSuggestions(dateKey);
};

function renderSuggestions(dateKey) {
  const list = document.getElementById('sugList');
  if(!list) return;
  const sugs = D.suggestions && D.suggestions[dateKey] ? D.suggestions[dateKey] : {};
  const entries = Object.entries(sugs).sort((a,b)=>((b[1].up||0)-(b[1].down||0))-((a[1].up||0)-(a[1].down||0)));

  if(!entries.length) {
    list.innerHTML=`<div class="sug-empty">HenÃ¼z Ã¶neri yok. Ä°lk Ã¶neriyi sen yaz! ğŸ‘†</div>`;
    return;
  }

  list.innerHTML = entries.map(([id, sug])=>{
    const voteKey = `voted_${dateKey}_${id}`;
    const myVote = localStorage.getItem(voteKey);
    const upCls = myVote==='up' ? 'voted-up' : '';
    const downCls = myVote==='down' ? 'voted-down' : '';
    const score = (sug.up||0)-(sug.down||0);
    return `<div class="sug-item">
      <div class="sug-text">${escHtml(sug.text)}</div>
      <div class="sug-votes">
        <button class="vote-btn ${upCls}" onclick="voteSuggestion('${dateKey}','${id}','up')">
          ğŸ‘ <span class="vote-count">${sug.up||0}</span>
        </button>
        <button class="vote-btn ${downCls}" onclick="voteSuggestion('${dateKey}','${id}','down')">
          ğŸ‘ <span class="vote-count">${sug.down||0}</span>
        </button>
      </div>
    </div>`;
  }).join('');
}

function escHtml(s) {
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

// â”€â”€â”€ BEST â”€â”€â”€
function renderBest() {
  const el=document.getElementById('bestList');
  const scored=Object.entries(D.availability).map(([key,dd])=>{
    let sc=0; const att={yes:[],maybe:[],hard:[],no:[]};
    Object.entries(dd).forEach(([pid,s])=>{sc+=SS[s]||0;if(att[s])att[s].push(pid);});
    return{key,sc,att};
  }).filter(x=>x.sc>0).sort((a,b)=>b.sc-a.sc).slice(0,5);
  if(!scored.length){el.innerHTML=`<div class="empty"><div class="empty-icon">ğŸ“…</div><h3>Veri yok</h3><p>Takvimde gÃ¼nlere tÄ±klayarak mÃ¼saitliÄŸini gir.</p></div>`;return;}
  const topColors=['linear-gradient(90deg,#007aff,#5ac8fa)','linear-gradient(90deg,#af52de,#007aff)','linear-gradient(90deg,#c0c0c0,#af52de)'];
  const ranks=['ğŸ¥‡ 1. Ã–neri','ğŸ¥ˆ 2. Ã–neri','ğŸ¥‰ 3. Ã–neri'];
  el.innerHTML=scored.map((d,i)=>{
    const dt=pdk(d.key);
    const ds=`${DY[dt.getDay()]}, ${dt.getDate()} ${MO[dt.getMonth()]} ${dt.getFullYear()}`;
    const isL=D.lockedDates.some(l=>l.date===d.key);
    const sugCount = D.suggestions&&D.suggestions[d.key] ? Object.keys(D.suggestions[d.key]).length : 0;
    return`<div class="best-card"><div class="best-card-top" style="background:${topColors[i]||'#ccc'}"></div><div class="bc-body"><div class="bc-rank">${ranks[i]||`#${i+1}`}</div><div class="bc-date">${ds}</div><div class="bc-pills">${d.att.yes.map(pid=>{const p=P.find(x=>x.id===pid);return`<div class="bc-pill bcp-y">${p.e} ${p.name}</div>`;}).join('')}${d.att.maybe.map(pid=>{const p=P.find(x=>x.id===pid);return`<div class="bc-pill bcp-m">${p.e} ${p.name}</div>`;}).join('')}${d.att.hard.map(pid=>{const p=P.find(x=>x.id===pid);return`<div class="bc-pill bcp-h">${p.e} ${p.name}</div>`;}).join('')}${d.att.no.map(pid=>{const p=P.find(x=>x.id===pid);return`<div class="bc-pill bcp-n">${p.e} ${p.name}</div>`;}).join('')}</div><div style="display:flex;gap:7px;flex-wrap:wrap"><span class="badge badge-blue">+${d.sc}p</span>${d.att.yes.length?`<span class="badge badge-green">âœ… ${d.att.yes.length} kesin</span>`:''}${sugCount?`<span class="badge" style="background:rgba(175,82,222,.1);color:var(--purple)">ğŸ’¡ ${sugCount} Ã¶neri</span>`:''}</div></div><div class="bc-footer">${isL?'<button class="btn-sm" style="opacity:.5;cursor:default">ğŸ”’ Kilitlendi</button>':`<button class="btn-sm btn-sm-orange" onclick="lockDate('${d.key}')">ğŸ”’ Kilitle</button>`}<button class="btn-sm" onclick="goToCal('${d.key}')">ğŸ“… Takvimde GÃ¶r</button></div></div>`;
  }).join('');
}

window.lockDate = function(key) {
  const h=prompt('BuluÅŸma saati?','19:00')||'19:00';
  const att=Object.entries(D.availability[key]||{}).filter(([,s])=>s!=='no').map(([pid])=>pid);
  if(!Array.isArray(D.lockedDates)) D.lockedDates=[];
  D.lockedDates.push({date:key,hour:h,attendees:att});
  saveToFirebase(); toast('ğŸ”’ Kilitlendi!');
  setTimeout(()=>showPage('Locked',document.querySelectorAll('.bn-item')[4]),500);
};

window.goToCal = function(key) {
  const dt=pdk(key); vDate=new Date(dt.getFullYear(),dt.getMonth(),1);
  showPage('Calendar',document.querySelectorAll('.bn-item')[0]); renderCal();
};

// â”€â”€â”€ LEAGUE â”€â”€â”€
function renderLeague() {
  const sorted=[...P].map(p=>({...p,sc:pSc(p.id),m:pMet(p.id),b:calcBadges(p.id)})).sort((a,b)=>b.sc-a.sc);
  const max=Math.max(...sorted.map(s=>s.sc),1);
  const rc=[{cls:'g',sym:'ğŸ¥‡'},{cls:'s',sym:'ğŸ¥ˆ'},{cls:'b',sym:'ğŸ¥‰'}];
  document.getElementById('leagueList').innerHTML=sorted.map((p,i)=>`
    <div class="league-item">
      <div class="li-rank ${rc[i]?.cls||''}">${rc[i]?.sym||i+1}</div>
      <div class="li-emoji">${p.e}</div>
      <div class="li-info">
        <div class="li-name">${p.name} <span style="font-size:13px">${p.b.map(b=>b.i).join('')}</span></div>
        <div class="li-badges" style="font-size:11px;color:var(--text3);margin-top:2px">âœ…${p.m.yes} ğŸ¤”${p.m.maybe} âŒ${p.m.no}</div>
      </div>
      <div class="li-right">
        <div class="li-score">${p.sc}</div>
        <div class="li-bar"><div class="li-bar-fill" style="width:${(p.sc/max)*100}%"></div></div>
      </div>
    </div>`).join('');
  const allB=[
    {i:'ğŸ”¥',n:'ToplayÄ±cÄ±',o:sorted.reduce((a,b)=>a.m.yes>=b.m.yes?a:b).name,d:'En Ã§ok Kesin'},
    {i:'ğŸƒ',n:'KaÃ§ak',o:sorted.reduce((a,b)=>a.m.no>=b.m.no?a:b).name,d:'En Ã§ok âŒ'},
    {i:'ğŸ§ ',n:'Stratejist',o:sorted.reduce((a,b)=>a.m.maybe>=b.m.maybe?a:b).name,d:'En Ã§ok ğŸ¤”'},
    {i:'ğŸ†',n:'MVP',o:sorted[0].name,d:'En yÃ¼ksek puan'},
    {i:'ğŸ’¤',n:'Sessiz',o:sorted[sorted.length-1].name,d:'En az aktif'},
  ];
  document.getElementById('badgeList').innerHTML=allB.map(b=>`
    <div class="card-item"><div class="ci-left"><div class="ci-icon">${b.i}</div><div class="ci-info"><div class="ci-title">${b.n}</div><div class="ci-sub">${b.o} Â· ${b.d}</div></div></div></div>`).join('');
}

// â”€â”€â”€ STATS â”€â”€â”€
function renderStats() {
  const allSt=Object.values(D.availability).flatMap(d=>Object.values(d));
  const tot=allSt.length,yc=allSt.filter(s=>s==='yes').length,nc=allSt.filter(s=>s==='no').length;
  const chaos=tot?Math.round((nc/tot)*100):0, part=tot?Math.round((yc/tot)*100):0;
  document.getElementById('kpiGrid').innerHTML=[
    {l:'Toplam Ä°ÅŸaret',v:tot,s:'kayÄ±t',c:'kv-blue'},
    {l:'Kesin KatÄ±lÄ±m',v:yc,s:`${part}% oran`,c:'kv-green'},
    {l:'Bahane SayÄ±sÄ±',v:nc,s:'âŒ iÅŸaret',c:'kv-red'},
    {l:'Kilitlenen',v:D.lockedDates.length,s:'buluÅŸma',c:'kv-blue'},
  ].map(k=>`<div class="kpi"><div class="kpi-label">${k.l}</div><div class="kpi-val ${k.c}">${k.v}</div><div class="kpi-sub">${k.s}</div></div>`).join('');
  document.getElementById('chaosCard').innerHTML=`
    <div class="chaos-header">
      <div><div style="font-size:12px;font-weight:700;color:var(--text2);margin-bottom:4px">Kaos Seviyesi</div>
      <div class="chaos-val" style="color:${chaos>50?'var(--red)':chaos>25?'var(--orange)':'var(--green)'}">${chaos}%</div></div>
      <div style="text-align:right;font-size:13px;color:var(--text2);max-width:150px;line-height:1.4">${chaos>50?'ğŸ”¥ Grup daÄŸÄ±lÄ±yor!':chaos>25?'âš¡ Dikkatli ol':'âœ… Her ÅŸey yolunda'}</div>
    </div>
    <div class="chaos-bar"><div class="chaos-fill" style="width:${chaos}%"></div></div>`;
  const sorted=[...P].map(p=>({...p,sc:pSc(p.id),m:pMet(p.id)})).sort((a,b)=>b.sc-a.sc);
  document.getElementById('personBreakdown').innerHTML=sorted.map(p=>`
    <div class="card-item">
      <div class="ci-left"><div class="ci-icon">${p.e}</div>
        <div class="ci-info"><div class="ci-title">${p.name}</div>
          <div style="display:flex;gap:5px;margin-top:3px">
            <span class="badge badge-green" style="font-size:10px;padding:2px 6px">âœ…${p.m.yes}</span>
            <span class="badge badge-gray" style="font-size:10px;padding:2px 6px">ğŸ¤”${p.m.maybe}</span>
            <span class="badge badge-red" style="font-size:10px;padding:2px 6px">âŒ${p.m.no}</span>
          </div>
        </div>
      </div>
      <div style="font-size:18px;font-weight:800">${p.sc}</div>
    </div>`).join('');
}

// â”€â”€â”€ LOCKED â”€â”€â”€
function renderLocked() {
  const el=document.getElementById('lockedList');
  const locks = Array.isArray(D.lockedDates) ? D.lockedDates : Object.values(D.lockedDates||{});
  if(!locks.length){el.innerHTML=`<div class="empty"><div class="empty-icon">ğŸ”“</div><h3>Kilitlenen yok</h3><p>En Ä°yi Tarihler'den bir slot kilitle.</p></div>`;return;}
  el.innerHTML=locks.map((l,idx)=>{
    const dt=pdk(l.date);
    const ds=`${DY[dt.getDay()]}, ${dt.getDate()} ${MO[dt.getMonth()]} ${dt.getFullYear()}`;
    const att=l.attendees.map(pid=>P.find(p=>p.id===pid)).filter(Boolean);
    const miss=P.filter(p=>!l.attendees.includes(p.id));
    const wa=`âš” VALERON MEHMET\nğŸ“… ${ds} â° ${l.hour}\n\nâœ… KatÄ±lanlar:\n${att.map(p=>`${p.e} ${p.name}`).join('\n')}${miss.length?`\n\nâŒ KatÄ±lamayanlar:\n${miss.map(p=>`${p.e} ${p.name}`).join('\n')}`:''}`;
    const enc=encodeURIComponent(wa+'\n\nTakvim konuÅŸtu. KaÃ§Ä±ÅŸ yok. ğŸ”’');
    return`<div class="locked-card">
      <div class="locked-banner">
        <div><div style="font-size:9px;font-weight:800;color:var(--orange);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:3px">âœ… KESÄ°NLEÅTÄ°</div><div class="locked-date-str">${ds}</div></div>
        <div class="locked-time">â° ${l.hour}</div>
      </div>
      <div class="locked-body">
        ${att.length?`<div class="locked-sec">KatÄ±lanlar</div><div class="locked-pills">${att.map(p=>`<div class="bc-pill bcp-y">${p.e} ${p.name}</div>`).join('')}</div>`:''}
        ${miss.length?`<div class="locked-sec">KatÄ±lamayanlar</div><div class="locked-pills">${miss.map(p=>`<div class="bc-pill bcp-n">${p.e} ${p.name}</div>`).join('')}</div>`:''}
        <div class="locked-sec">Mesaj</div>
        <div class="wa-box">${wa}</div>
        <div class="locked-quote">"Takvim konuÅŸtu. KaÃ§Ä±ÅŸ yok."</div>
      </div>
      <div class="locked-footer">
        <button class="btn-sm btn-sm-primary" onclick="cpWA(${idx})">ğŸ“‹ Kopyala</button>
        <a href="https://wa.me/?text=${enc}" target="_blank"><button class="btn-sm" style="color:#25d366">ğŸ’¬ WA</button></a>
        <button class="btn-sm" onclick="dlICS(${idx})">ğŸ“… .ics</button>
        <button class="btn-sm" style="color:var(--red)" onclick="ulk(${idx})">ğŸ—‘</button>
      </div>
    </div>`;
  }).join('');
}

window.cpWA = function(i) {
  const locks=Array.isArray(D.lockedDates)?D.lockedDates:Object.values(D.lockedDates||{});
  const l=locks[i]; const dt=pdk(l.date);
  const ds=`${DY[dt.getDay()]}, ${dt.getDate()} ${MO[dt.getMonth()]} ${dt.getFullYear()}`;
  const att=l.attendees.map(pid=>P.find(p=>p.id===pid)).filter(Boolean);
  const miss=P.filter(p=>!l.attendees.includes(p.id));
  const wa=`âš” VALERON MEHMET\nğŸ“… ${ds} â° ${l.hour}\n\nâœ… KatÄ±lanlar:\n${att.map(p=>`${p.e} ${p.name}`).join('\n')}${miss.length?`\n\nâŒ KatÄ±lamayanlar:\n${miss.map(p=>`${p.e} ${p.name}`).join('\n')}`:''}`;
  navigator.clipboard.writeText(wa+'\n\nTakvim konuÅŸtu. KaÃ§Ä±ÅŸ yok. ğŸ”’').then(()=>toast('ğŸ“‹ KopyalandÄ±!'));
};

window.dlICS = function(i) {
  const locks=Array.isArray(D.lockedDates)?D.lockedDates:Object.values(D.lockedDates||{});
  const l=locks[i]; const dt=pdk(l.date);
  const y=dt.getFullYear(),mo=String(dt.getMonth()+1).padStart(2,'0'),d=String(dt.getDate()).padStart(2,'0');
  const[hh,mm]=(l.hour||'19:00').split(':');
  const s=`${y}${mo}${d}T${String(hh).padStart(2,'0')}${String(mm||0).padStart(2,'0')}00`;
  const e=`${y}${mo}${d}T${String(Number(hh)+3).padStart(2,'0')}${String(mm||0).padStart(2,'0')}00`;
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([`BEGIN:VCALENDAR\nVERSION:2.0\nBEGIN:VEVENT\nSUMMARY:âš” Valeron Mehmet BuluÅŸmasÄ±\nDTSTART:${s}\nDTEND:${e}\nEND:VEVENT\nEND:VCALENDAR`],{type:'text/calendar'}));
  a.download='bulusma.ics'; a.click(); toast('ğŸ“… Ä°ndirildi!');
};

window.ulk = function(i) {
  if(!confirm('Silinsin mi?')) return;
  const locks=Array.isArray(D.lockedDates)?[...D.lockedDates]:Object.values(D.lockedDates||{});
  locks.splice(i,1); D.lockedDates=locks;
  saveToFirebase(); toast('ğŸ—‘ Silindi!');
};

// â”€â”€â”€ METER â”€â”€â”€
function renderMeter() {
  const pill=document.getElementById('meterPill'),txt=document.getElementById('mTxt'),ico=document.getElementById('mIco');
  if(!D.lastMeeting){pill.className='pill pill-default';txt.textContent='Tarih gir';ico.textContent='ğŸ“…';return;}
  const days=Math.floor((new Date()-new Date(D.lastMeeting))/86400000);
  if(days>45){pill.className='pill pill-crit';ico.textContent='âš ';txt.textContent=`${days}g`;}
  else if(days>30){pill.className='pill pill-warn';ico.textContent='âš¡';txt.textContent=`${days}g`;}
  else{pill.className='pill pill-ok';ico.textContent='âœ…';txt.textContent=`${days}g`;}
}

window.setLastMeeting = function() {
  const d=prompt('Son buluÅŸma tarihi (YYYY-MM-DD):',new Date().toISOString().split('T')[0]);
  if(d&&/^\d{4}-\d{2}-\d{2}$/.test(d)){D.lastMeeting=d;saveToFirebase();toast('ğŸ“… GÃ¼ncellendi!');}
};

function updLastMeetingLabel() {
  const el=document.getElementById('lastMeetingLabel');
  if(el) el.textContent=D.lastMeeting?`Son: ${D.lastMeeting}`:'Tarih girilmedi';
}

// â”€â”€â”€ SCORING â”€â”€â”€
function pSc(pid){let s=0;Object.values(D.availability).forEach(d=>{if(d[pid])s+=SS[d[pid]]||0;});return s;}
function pMet(pid){const m={yes:0,no:0,maybe:0,hard:0};Object.values(D.availability).forEach(d=>{if(d[pid])m[d[pid]]++;});return m;}
function calcBadges(pid){
  const b=[],m=pMet(pid);
  const mY=Math.max(...P.map(p=>pMet(p.id).yes),0),mN=Math.max(...P.map(p=>pMet(p.id).no),0),mM=Math.max(...P.map(p=>pMet(p.id).maybe),0),mS=Math.max(...P.map(p=>pSc(p.id)),0);
  if(m.yes===mY&&mY>0)b.push({i:'ğŸ”¥'});
  if(m.no===mN&&mN>0)b.push({i:'ğŸƒ'});
  if(m.maybe===mM&&mM>0)b.push({i:'ğŸ§ '});
  if(pSc(pid)===mS&&mS>0)b.push({i:'ğŸ†'});
  if(m.yes&&m.maybe&&m.hard)b.push({i:'ğŸ•Š'});
  return b;
}

// â”€â”€â”€ UTILS â”€â”€â”€
function updLockDot(){
  const n=(Array.isArray(D.lockedDates)?D.lockedDates:Object.values(D.lockedDates||{})).length;
  document.getElementById('lockDot').classList.toggle('show',n>0);
}

window.resetData = function() {
  if(!confirm('TÃ¼m veriler herkesten silinsin mi? Bu iÅŸlem geri alÄ±namaz!')) return;
  D={availability:{},lockedDates:[],lastMeeting:null,suggestions:{}};
  saveToFirebase(); toast('ğŸ—‘ SÄ±fÄ±rlandÄ±!');
};

function toast(msg){
  const w=document.getElementById('tw');const t=document.createElement('div');
  t.className='toast';t.textContent=msg;w.appendChild(t);
  setTimeout(()=>{t.style.opacity='0';t.style.transition='opacity .3s';},2000);
  setTimeout(()=>t.remove(),2400);
}

</script>

</body>
</html>
